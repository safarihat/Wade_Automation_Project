{% extends 'wade_automation/base.html' %}

{% block content %}
<div class="container mt-5">
  <h2>Review Invoices</h2>
  <p class="text-muted">Review and adjust any fields below, then click Save to create the invoices.</p>
  <form method="post" action="{% url 'invoices:confirm_invoices' %}">
    {% csrf_token %}
    {% for inv in pending %}
      <div class="card" style="margin:16px 0; padding:16px; border:1px solid #e6e6e6; border-radius:8px; background:#fff;">
        <div style="display:flex; align-items:center; justify-content:space-between;">
          <strong>{{ inv.filename }}</strong>
          <a href="{{ inv.file_url }}" target="_blank" style="font-size: 0.9rem;">View file</a>
        </div>
        <input type="hidden" name="file_path" value="{{ inv.file_path }}" />
        <div class="row" style="display:flex; gap:16px; flex-wrap:wrap; margin-top:12px;">
          <label style="flex:1; min-width:220px;">
            <div>Vendor</div>
            <input name="vendor" value="{{ inv.vendor }}" class="form-control" />
          </label>
          <label style="flex:1; min-width:180px;">
            <div>Invoice Date</div>
            <input name="date" value="{{ inv.date }}" class="form-control" placeholder="YYYY-MM-DD" />
          </label>
          <label style="flex:1; min-width:140px;">
            <div>Subtotal</div>
            <input name="subtotal" value="{{ inv.subtotal }}" class="form-control" />
          </label>
          <label style="flex:1; min-width:140px;">
            <div>Tax Total (GST/VAT)</div>
            <input name="tax_total" value="{{ inv.tax_total }}" class="form-control" />
          </label>
          <label style="flex:1; min-width:140px;">
            <div>Grand Total</div>
            <input name="amount" value="{{ inv.amount }}" class="form-control" />
          </label>
        </div>
        <div style="margin-top:12px;">
          <label>
            <div>Line Items (one per line, use "Description|Qty|Unit Price|Line Total")</div>
            <textarea name="lines_text" class="form-control" rows="4" placeholder="Desc|1|100.00|100.00">{{ inv.lines_text }}</textarea>
          </label>
        </div>
      </div>
    {% endfor %}
    <div style="margin-top:16px;">
      <button type="submit" class="btn btn-primary">Save</button>
      <a href="{% url 'invoices:invoice_dashboard' %}" class="btn btn-secondary">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}
